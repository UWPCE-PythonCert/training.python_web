<!--
Google IO 2012/2013 HTML5 Slide Template

Authors: Eric Bidelman <ebidel@gmail.com>
         Luke Mah√© <lukem@google.com>

URL: https://code.google.com/p/io-2012-slides
--><!DOCTYPE html>


<html>
<head>
  <title>Session 06 &mdash; Internet Programming with Python</title>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">-->
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
  <!--This one seems to work all the time, but really small on ipad-->
  <!--<meta name="viewport" content="initial-scale=0.4">-->
  <meta name="apple-mobile-web-app-capable" content="yes">

  
  <link rel="stylesheet" media="all"
        href="../_static/theme/css/default.css">
  <link rel="stylesheet" media="all"
        href="../_static/theme/css/hieroglyph.css">
  <link rel="stylesheet" media="only screen and (max-device-width: 480px)"
        href="../_static/theme/css/phone.css">

    
    <link rel="stylesheet" href="../_static/custom.css"
          type="text/css" />
    

    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <base target="_blank"> <!-- This amazingness opens all links in a new tab. -->
  
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script data-main="../_static/js/slides"
            src="../_static/js/require-1.0.8.min.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="Internet Programming with Python" href="../index.html" />
    <link rel="up" title="Course Presentations" href="index.html" />
    <link rel="next" title="Session 07" href="session07.html" />
    <link rel="prev" title="Session 05" href="session05.html" /> 
</head>
<body style="opacity: 0">

<slides class="layout-widescreen">

  <slide class="title-slide segue nobackground">
  <aside class="gdbar"><img src="../_static/logo_UW.png"></aside>
  <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
  <hgroup class="auto-fadein">
    <h1 data-config-title><!-- populated from slide_config.json --></h1>
    <h2 data-config-subtitle><!-- populated from slide_config.json --></h2>
    <p data-config-presenter><!-- populated from slide_config.json --></p>
  </hgroup>
</slide>

  
    <slide class="title-slide segue nobackground level-1" id="session-06">
    <hgroup>
      <h1>Session 06</h1>
    </hgroup>
    <article class="">
      <a class="reference internal image-reference" href="../_images/lj_entry.png"><img alt="../_images/lj_entry.png" class="align-center" src="../_images/lj_entry.png" style="width: 65%;" /></a>



<div class="slide-no">1</div>


    </article>
  </slide>  <slide class="level-2" id="interacting-with-data">
    <hgroup>
      <h2>Interacting with Data</h2>
    </hgroup>
    <article class="">
      <p><strong>Wherein we learn to display our data, and to create and edit it too!</strong></p>



<div class="slide-no">2</div>


    </article>
  </slide>  <slide class="level-3" id="but-first">
    <hgroup>
      <h3>But First</h3>
    </hgroup>
    <article class="">
      <p>Last week we discussed the <strong>model</strong> part of the <em>MVC</em> application design
pattern.</p>
<div class="build docutils container">
<p>We set up a project using the <a class="reference external" href="http://www.pylonsproject.org/projects/pyramid/about">Pyramid</a> web framework and the <a class="reference external" href="http://docs.sqlalchemy.org/en/rel_0_9/">SQLAlchemy</a>
library for persisting our data to a database.</p>
<p>We looked at how to define a simple model by investigating the demo model
created on our behalf.</p>
<p>And we went over, briefly, the way we can interact with this model at the
command line to make sure we've got it right.</p>
<p>Finally, we defined what attributes a learning journal entry would have,
and a pair of methods we think we will need to make the model complete.</p>
</div>



<div class="slide-no">3</div>


    </article>
  </slide>  <slide class="level-3" id="our-data-model">
    <hgroup>
      <h3>Our Data Model</h3>
    </hgroup>
    <article class="">
      <p>Over the last week, your assignment was to create the new model.</p>
<div class="build docutils container">
<p>Did you get that done?</p>
<p>If not, what stopped you?</p>
<p>Let's take a few minutes here to answer questions about this task so you
are more comfortable.</p>
<p>Questions?</p>
</div>



<div class="slide-no">4</div>


    </article>
  </slide>  <slide class="level-3" id="id4">
    <hgroup>
      <h3>A Complete Example</h3>
    </hgroup>
    <article class="">
      <p>I've added a working <code class="docutils literal"><span class="pre">models.py</span></code> file to our <a class="reference external" href="https://github.com/UWPCE-PythonCert/training.python_web/tree/master/resources/session06">class repository</a> in the
<code class="docutils literal"><span class="pre">resources/session06/</span></code> folder.</p>
<p>Let's review how it works.</p>



<div class="slide-no">5</div>


    </article>
  </slide>  <slide class="level-3" id="id5">
    <hgroup>
      <h3>Demo Interaction</h3>
    </hgroup>
    <article class="">
      <p>I've also made a few small changes to make the <code class="docutils literal"><span class="pre">pshell</span></code> command a bit more
helpful.</p>
<div class="build docutils container">
<p>In <code class="docutils literal"><span class="pre">learning_journal/__init__.py</span></code> I added the following function:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_session</span><span class="p">(</span><span class="n">settings</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="n">engine_from_config</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s1">&#39;sqlalchemy.&#39;</span><span class="p">)</span>
    <span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Session</span><span class="p">()</span>
</pre></div>
</div>
<p>Then, in <code class="docutils literal"><span class="pre">development.ini</span></code> I added the following configuration:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[pshell]</span>
<span class="na">create_session</span> <span class="o">=</span> <span class="s">learning_journal.create_session</span>
<span class="na">entry</span> <span class="o">=</span> <span class="s">learning_journal.models.Entry</span>
</pre></div>
</div>
</div>



<div class="slide-no">6</div>


    </article>
  </slide>  <slide class="level-3" id="id6">
    <hgroup>
      <h3>Using the new <code class="docutils literal"><span class="pre">pshell</span></code></h3>
    </hgroup>
    <article class="">
      <p>Here's a demo interaction using <code class="docutils literal"><span class="pre">pshell</span></code> with these new features:</p>
<div class="build docutils container">
<p>First <code class="docutils literal"><span class="pre">cd</span></code> to your project code, fire up your project virtualenv and
start python:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> projects/learning-journal/learning_journal
$ <span class="nb">source</span> ../ljenv/bin/activate
<span class="o">(</span>ljenv<span class="o">)</span>$ pshell development.ini
Python 3.5.0 <span class="o">(</span>default, Sep <span class="m">16</span> 2015, 10:42:55<span class="o">)</span>
...
Environment:
  app          The WSGI application.
  ...
Custom Variables:
  create_session learning_journal.create_session
  entry        learning_journal.models.Entry

In <span class="o">[</span>1<span class="o">]</span>: <span class="nv">session</span> <span class="o">=</span> create_session<span class="o">(</span>registry.settings<span class="o">)</span>
</pre></div>
</div>
<p>[demo]</p>
</div>



<div class="slide-no">7</div>


    </article>
  </slide>  <slide class="level-2" id="the-mvc-controller">
    <hgroup>
      <h2>The MVC Controller</h2>
    </hgroup>
    <article class="">
      <div class="left docutils container">
<p>Let's go back to thinking for a bit about the <em>Model-View-Controller</em>
pattern.</p>
<div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="http://upload.wikimedia.org/wikipedia/commons/4/40/MVC_passive_view.png"><img alt="http://upload.wikimedia.org/wikipedia/commons/4/40/MVC_passive_view.png" src="http://upload.wikimedia.org/wikipedia/commons/4/40/MVC_passive_view.png" style="width: 25%;" /></a>
<p class="caption"><span class="caption-text">By Alan Evangelista (Own work) [CC0], via Wikimedia Commons</span></p>
</div>
<div class="build docutils container">
<p>We talked last week (and today) about the <em>model</em></p>
<p>Today, we'll dig into <em>controllers</em> and <em>views</em></p>
<p>or as we will know them in Pyramid: <em>views</em> and <em>renderers</em></p>
</div>
</div>



<div class="slide-no">8</div>


    </article>
  </slide>  <slide class="level-3" id="http-request-response">
    <hgroup>
      <h3>HTTP Request/Response</h3>
    </hgroup>
    <article class="">
      <p>Internet software is driven by the HTTP Request/Response cycle.</p>
<div class="build docutils container">
<p>A <em>client</em> (perhaps a user with a web browser) makes a <strong>request</strong></p>
<p>A <em>server</em> receives and handles that request and returns a <strong>response</strong></p>
<p>The <em>client</em> receives the response and views it, perhaps making a new
<strong>request</strong></p>
<p>And around and around it goes.</p>
</div>



<div class="slide-no">9</div>


    </article>
  </slide>  <slide class="level-3" id="id7">
    <hgroup>
      <h3>URLs</h3>
    </hgroup>
    <article class="">
      <p>An HTTP request arrives at a server through the magic of a <strong>URL</strong></p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>http://uwpce-pythoncert.github.io/training.python_web/html/index.html
</pre></div>
</div>
<div class="build docutils container">
<p>Let's break that up into its constituent parts:</p>
<dl class="build docutils">
<dt>http://:</dt>
<dd>This part is the <em>protocol</em>, it determines how the request will be sent</dd>
<dt>uwpce-pythoncert.github.io:</dt>
<dd>This is a <em>domain name</em>.  It's the human-facing address for a server
somewhere.</dd>
<dt>/training.python_web/html/index.html:</dt>
<dd>This part is the <em>path</em>.  It serves as a locator for a resource <em>on the
server</em></dd>
</dl>
</div>



<div class="slide-no">10</div>


    </article>
  </slide>  <slide class="level-3" id="id8">
    <hgroup>
      <h3>Paths</h3>
    </hgroup>
    <article class="">
      <p>In a static website (like our documentation) the <em>path</em> identifies a <strong>physical
location</strong> in the server's filesystem.</p>
<div class="build docutils container">
<p>Some directory on the server is the <em>home</em> for the web process, and the
<em>path</em> is looked up there.</p>
<p>Whatever resource (a file, an image, whatever) is located there is returned
to the user as a response.</p>
<p>If the path leads to a location that doesn't exist, the server responds
with a <strong>404 Not Found</strong> error.</p>
<p>In the golden days of yore, this was the only way content was served via
HTTP.</p>
</div>



<div class="slide-no">11</div>


    </article>
  </slide>  <slide class="level-3" id="id9">
    <hgroup>
      <h3>Paths in an MVC System</h3>
    </hgroup>
    <article class="">
      <p>In todays world we have dynamic systems, server-side web frameworks like
Pyramid.</p>
<div class="build docutils container">
<p>The requests that you send to a server are handled by a software process
that assembles a response instead of looking up a physical location.</p>
<p>But we still have URLs, with <em>protocol</em>, <em>domain</em> and <em>path</em>.</p>
<p>What is the role for a path in a process that doesn't refer to a physical
file system?</p>
<p>Most web frameworks now call the <em>path</em> a <strong>route</strong>.</p>
<p>They provide a way of matching <em>routes</em> to the code that will be run to
handle requests.</p>
</div>



<div class="slide-no">12</div>


    </article>
  </slide>  <slide class="level-3" id="routes-in-pyramid">
    <hgroup>
      <h3>Routes in Pyramid</h3>
    </hgroup>
    <article class="">
      <p>In Pyramid, routes are handled as <em>configuration</em> and are set up in the <em>main</em>
function in <code class="docutils literal"><span class="pre">__init__.py</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># learning_journal/__init__.py</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">global_config</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<div class="build docutils container">
<p>Our code template created a sample route for us, using the <code class="docutils literal"><span class="pre">add_route</span></code>
method of the <code class="docutils literal"><span class="pre">Configurator</span></code> class.</p>
<p>The <code class="docutils literal"><span class="pre">add_route</span></code> method has two required arguments: a <em>name</em> and a
<em>pattern</em></p>
<p>In our sample route, the <em>name</em> is <code class="docutils literal"><span class="pre">'home'</span></code></p>
<p>In our sample route, the <em>pattern</em> is <code class="docutils literal"><span class="pre">'/'</span></code></p>
</div>



<div class="slide-no">13</div>


    </article>
  </slide>  <slide class="level-3" id="id10">
    <hgroup>
      <h3>Routes in Pyramid</h3>
    </hgroup>
    <article class="">
      <p>When a request comes in to a Pyramid application, the framework looks at all
the <em>routes</em> that have been configured.</p>
<div class="build docutils container">
<p>One by one, in order, it tries to match the <em>path</em> of the incoming request
against the <em>pattern</em> of the route.</p>
<p>As soon as a <em>pattern</em> matches the <em>path</em> from the incoming request, that
route is used and no further matching is performed.</p>
<p>If no route is found that matches, then the request will automatically get
a <strong>404 Not Found</strong> error response.</p>
<p>In our sample app, we have one sample <em>route</em> named <code class="docutils literal"><span class="pre">'home'</span></code>, with a
pattern of <code class="docutils literal"><span class="pre">/</span></code>.</p>
<p>This means that any request that comes in for <code class="docutils literal"><span class="pre">/</span></code> will be matched to this
route, and any other request will be <strong>404</strong>.</p>
</div>



<div class="slide-no">14</div>


    </article>
  </slide>  <slide class="level-3" id="id11">
    <hgroup>
      <h3>Routes as API</h3>
    </hgroup>
    <article class="">
      <p>In a very real sense, the <em>routes</em> defined in an application <em>are</em> the public
API.</p>
<div class="build docutils container">
<p>Any route that is present represents something the user can do.</p>
<p>Any route that is not present is something the user cannot do.</p>
<p>You can use the proper definition of routes to help conceptualize what your
app will do.</p>
<p>What routes might we want for a learning journal application?</p>
<p>What will our application do?</p>
</div>



<div class="slide-no">15</div>


    </article>
  </slide>  <slide class="level-3" id="id12">
    <hgroup>
      <h3>Defining our Routes</h3>
    </hgroup>
    <article class="">
      <p>Let's add routes for our application.</p>
<div class="build docutils container">
<p>Open <code class="docutils literal"><span class="pre">learning_journal/__init__.py</span></code>.</p>
<p>For our list page, the existing <code class="docutils literal"><span class="pre">'home'</span></code> route will do fine, leave it.</p>
<p>Add the following two routes:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="c1"># already there</span>
<span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;detail&#39;</span><span class="p">,</span> <span class="s1">&#39;/journal/{id:\d+}&#39;</span><span class="p">)</span>
<span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="s1">&#39;/journal/{action}&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">'detail'</span></code> route will serve a single journal entry, identified by an
<code class="docutils literal"><span class="pre">id</span></code>.</p>
<p>The <code class="docutils literal"><span class="pre">action</span></code> route will serve <code class="docutils literal"><span class="pre">create</span></code> and <code class="docutils literal"><span class="pre">edit</span></code> views, depending on
the <code class="docutils literal"><span class="pre">action</span></code> specified.</p>
<p>In both cases, we want to capture a portion of the matched path to use
information it provides.</p>
</div>



<div class="slide-no">16</div>


    </article>
  </slide>  <slide class="level-3" id="id13">
    <hgroup>
      <h3>Matching an ID</h3>
    </hgroup>
    <article class="">
      <p>In a pattern, you can capture a <code class="docutils literal"><span class="pre">path</span> <span class="pre">segment</span></code> <em>replacement
marker</em>, a valid Python symbol surrounded by curly braces:</p>
<div class="build docutils container">
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">{</span><span class="n">foo</span><span class="p">}</span><span class="o">/</span>
</pre></div>
</div>
<p>If you want to match a particular pattern, like digits only, add a
<em>regular expression</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">journal</span><span class="o">/</span><span class="p">{</span><span class="nb">id</span><span class="p">:</span>\<span class="n">d</span><span class="o">+</span><span class="p">}</span>
</pre></div>
</div>
<p>Matched path segments are captured in a <code class="docutils literal"><span class="pre">matchdict</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># pattern          # actual url   # matchdict</span>
<span class="o">/</span><span class="n">journal</span><span class="o">/</span><span class="p">{</span><span class="nb">id</span><span class="p">:</span>\<span class="n">d</span><span class="o">+</span><span class="p">}</span>  <span class="o">/</span><span class="n">journal</span><span class="o">/</span><span class="mi">27</span>    <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;27&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">matchdict</span></code> is made available as an attribute of the <em>request object</em></p>
<p>(more on that soon)</p>
</div>



<div class="slide-no">17</div>


    </article>
  </slide>  <slide class="level-3" id="id14">
    <hgroup>
      <h3>Connecting Routes to Views</h3>
    </hgroup>
    <article class="">
      <p>In Pyramid, a <em>route</em> is connected by configuration to a <em>view</em>.</p>
<div class="build docutils container">
<p>In our app, a sample view has been created for us, in <code class="docutils literal"><span class="pre">views.py</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;templates/mytemplate.pt&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>The order in which <em>routes</em> are configured <em>is important</em>, so that must be
done in <code class="docutils literal"><span class="pre">__init__.py</span></code>.</p>
<p>The order in which views are connected to routes <em>is not important</em>, so the
<em>declarative</em> <code class="docutils literal"><span class="pre">&#64;view_config</span></code> decorator can be used.</p>
<p>When <code class="docutils literal"><span class="pre">config.scan</span></code> is called, all files in our application are searched
for such <em>declarative configuration</em> and it is added.</p>
</div>



<div class="slide-no">18</div>


    </article>
  </slide>  <slide class="level-3" id="the-pyramid-view">
    <hgroup>
      <h3>The Pyramid View</h3>
    </hgroup>
    <article class="">
      <p>Let's imagine that a <em>request</em> has come to our application for the path
<code class="docutils literal"><span class="pre">'/'</span></code>.</p>
<div class="build docutils container">
<p>The framework made a match of that path to a <em>route</em> with the pattern <code class="docutils literal"><span class="pre">'/'</span></code>.</p>
<p>Configuration connected that route to a <em>view</em> in our application.</p>
<p>Now, the view that was connected will be <em>called</em>, which brings us to the
nature of <em>views</em></p>
<p class="centered">--A Pyramid view is a <em>callable</em> that takes <em>request</em> as an argument--</p>
<p>Remember what a <em>callable</em> is?</p>
</div>



<div class="slide-no">19</div>


    </article>
  </slide>  <slide class="level-3" id="id15">
    <hgroup>
      <h3>What the View Does</h3>
    </hgroup>
    <article class="">
      <p>So, a <em>view</em> is a callable that takes the <em>request</em> as an argument.</p>
<div class="build docutils container">
<p>It can then use information from that request to build appropriate data,
perhaps using the application's <em>models</em>.</p>
<p>Then, it returns the data it assembled, passing it on to a <a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid/en/1.5-branch/narr/renderers.html">renderer</a>.</p>
<p>Which <em>renderer</em> to use is determined, again, by configuration:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;templates/mytemplate.pt&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>More about this in a moment.</p>
<p>The <em>view</em> stands at the intersection of <em>input data</em>, the application
<em>model</em> and <em>renderers</em> that offer rendering of the results.</p>
<p>It is the <em>Controller</em> in our MVC application.</p>
</div>



<div class="slide-no">20</div>


    </article>
  </slide>  <slide class="level-3" id="id16">
    <hgroup>
      <h3>Adding Stub Views</h3>
    </hgroup>
    <article class="">
      <p>Add temporary views to our application in <code class="docutils literal"><span class="pre">views.py</span></code> (and comment out the
sample view):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;string&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;list page&#39;</span>

<span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;detail&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;string&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;detail page&#39;</span>

<span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="n">match_param</span><span class="o">=</span><span class="s1">&#39;action=create&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;string&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;create page&#39;</span>

<span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="n">match_param</span><span class="o">=</span><span class="s1">&#39;action=edit&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;string&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;edit page&#39;</span>
</pre></div>
</div>



<div class="slide-no">21</div>


    </article>
  </slide>  <slide class="level-3" id="id17">
    <hgroup>
      <h3>Testing Our Views</h3>
    </hgroup>
    <article class="">
      <p>Now we can verify that our view configuration has worked.</p>
<div class="build docutils container">
<p>Make sure your virtualenv is properly activated, and start the web server:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">(</span>ljenv<span class="o">)</span>$ pserve development.ini
Starting server in PID 84467.
serving on http://0.0.0.0:6543
</pre></div>
</div>
<p>Then try viewing some of the expected application urls:</p>
<ul class="build simple">
<li><a class="reference external" href="http://localhost:6543/">http://localhost:6543/</a></li>
<li><a class="reference external" href="http://localhost:6543/journal/1">http://localhost:6543/journal/1</a></li>
<li><a class="reference external" href="http://localhost:6543/journal/create">http://localhost:6543/journal/create</a></li>
<li><a class="reference external" href="http://localhost:6543/journal/edit">http://localhost:6543/journal/edit</a></li>
</ul>
<p>What happens if you visit a URL that <em>isn't</em> in our configuration?</p>
</div>



<div class="slide-no">22</div>


    </article>
  </slide>  <slide class="level-3" id="id18">
    <hgroup>
      <h3>Interacting With the Model</h3>
    </hgroup>
    <article class="">
      <p>Now that we've got temporary views that work, we can fix them to get
information from our database</p>
<div class="build docutils container">
<p>We'll begin with the list view.</p>
<p>We need some code that will fetch all the journal entries we've written, in
reverse order, and hand that collection back for rendering.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DBSession</span><span class="p">,</span>
    <span class="n">MyModel</span><span class="p">,</span>
    <span class="n">Entry</span><span class="p">,</span> <span class="c1"># &lt;- Add this import</span>
<span class="p">)</span>

<span class="c1"># and update this view function</span>
<span class="k">def</span> <span class="nf">index_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;entries&#39;</span><span class="p">:</span> <span class="n">entries</span><span class="p">}</span>
</pre></div>
</div>
</div>



<div class="slide-no">23</div>


    </article>
  </slide>  <slide class="level-3" id="id19">
    <hgroup>
      <h3>Using the <code class="docutils literal"><span class="pre">matchdict</span></code></h3>
    </hgroup>
    <article class="">
      <p>Next, we want to write the view for a single entry.</p>
<div class="build docutils container">
<p>We'll need to use the <code class="docutils literal"><span class="pre">id</span></code> value our route captures into the
<code class="docutils literal"><span class="pre">matchdict</span></code>.</p>
<p>Remember that the <code class="docutils literal"><span class="pre">matchdict</span></code> is an attribute of the request.</p>
<p>We'll get the <code class="docutils literal"><span class="pre">id</span></code> from there, and use it to get the correct entry.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># add this import at the top</span>
<span class="kn">from</span> <span class="nn">pyramid.httpexceptions</span> <span class="kn">import</span> <span class="n">HTTPNotFound</span>

<span class="c1"># and update this view function:</span>
<span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">this_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">matchdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">entry</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">by_id</span><span class="p">(</span><span class="n">this_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">entry</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HTTPNotFound</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;entry&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="p">}</span>
</pre></div>
</div>
</div>



<div class="slide-no">24</div>


    </article>
  </slide>  <slide class="level-3" id="id20">
    <hgroup>
      <h3>Testing Our Views</h3>
    </hgroup>
    <article class="">
      <p>We can now verify that these views work correctly.</p>
<div class="build docutils container">
<p>Make sure your virtualenv is properly activated, and start the web server:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">(</span>ljenv<span class="o">)</span>$ pserve development.ini
Starting server in PID 84467.
serving on http://0.0.0.0:6543
</pre></div>
</div>
<p>Then try viewing the list page and an entry page:</p>
<ul class="simple">
<li><a class="reference external" href="http://localhost:6543">http://localhost:6543</a></li>
<li><a class="reference external" href="http://localhost:6543/journal/1">http://localhost:6543/journal/1</a></li>
</ul>
<p>What happens when you request an entry with an id that isn't in the
database?</p>
<ul class="simple">
<li><a class="reference external" href="http://localhost:6543/journal/100">http://localhost:6543/journal/100</a></li>
</ul>
</div>



<div class="slide-no">25</div>


    </article>
  </slide>  <slide class="level-2" id="the-mvc-view">
    <hgroup>
      <h2>The MVC View</h2>
    </hgroup>
    <article class="">
      <div class="left docutils container">
<p>Again, back to the <em>Model-View-Controller</em> pattern.</p>
<div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="http://upload.wikimedia.org/wikipedia/commons/4/40/MVC_passive_view.png"><img alt="http://upload.wikimedia.org/wikipedia/commons/4/40/MVC_passive_view.png" src="http://upload.wikimedia.org/wikipedia/commons/4/40/MVC_passive_view.png" style="width: 25%;" /></a>
<p class="caption"><span class="caption-text">By Alan Evangelista (Own work) [CC0], via Wikimedia Commons</span></p>
</div>
<div class="build docutils container">
<p>We've built a <em>model</em> and we've created some <em>controllers</em> that use it.</p>
<p>In Pyramid, we call <em>controllers</em> <strong>views</strong> and they are callables that
take <em>request</em> as an argument.</p>
<p>Let's turn to the last piece of the <em>MVC</em> patter, the <em>view</em></p>
</div>
</div>



<div class="slide-no">26</div>


    </article>
  </slide>  <slide class="level-3" id="presenting-data">
    <hgroup>
      <h3>Presenting Data</h3>
    </hgroup>
    <article class="">
      <p>The job of the <em>view</em> in the <em>MVC</em> pattern is to present data in a format that
is readable to the user of the system.</p>
<div class="build docutils container">
<p>There are many ways to present data.</p>
<p>Some are readable by humans (tables, charts, graphs, HTML pages, text
files).</p>
<p>Some are more for machines (xml files, csv, json).</p>
<p>Which of these formats is the <em>right one</em> depends on your purpose.</p>
<p>What is the purpose of our learning journal?</p>
</div>



<div class="slide-no">27</div>


    </article>
  </slide>  <slide class="level-3" id="pyramid-renderers">
    <hgroup>
      <h3>Pyramid Renderers</h3>
    </hgroup>
    <article class="">
      <p>In Pyramid, the job of presenting data is performed by a <em>renderer</em>.</p>
<div class="build docutils container">
<p>So we can consider the Pyramid <strong>renderer</strong> to be the <em>view</em> in our <em>MVC</em>
app.</p>
<p>We've already seen how we can connect a <em>renderer</em> to a Pyramid <em>view</em> with
configuration.</p>
<p>In fact, we have already done so, using a built-in renderer called
<code class="docutils literal"><span class="pre">'string'</span></code>.</p>
<p>This renderer converts the return value of its <em>view</em> to a string and sends
that back to the client as an HTTP response.</p>
<p>But the result isn't so nice looking.</p>
</div>



<div class="slide-no">28</div>


    </article>
  </slide>  <slide class="level-3" id="id21">
    <hgroup>
      <h3>Template Renderers</h3>
    </hgroup>
    <article class="">
      <p>The <cite>built-in renderers</cite> (<code class="docutils literal"><span class="pre">'string'</span></code>, <code class="docutils literal"><span class="pre">'json'</span></code>, <code class="docutils literal"><span class="pre">'jsonp'</span></code>) in Pyramid are
not the only ones available.</p>
<div class="build docutils container">
<p>There are add-ons to Pyramid that support using various <em>template
languages</em> as renderers.</p>
<p>In fact, one of these was installed by default when you created this
project.</p>
</div>



<div class="slide-no">29</div>


    </article>
  </slide>  <slide class="level-3" id="id22">
    <hgroup>
      <h3>Configuring a Template Renderer</h3>
    </hgroup>
    <article class="">
      <div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># in setup.py</span>
<span class="n">requires</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;pyramid_chameleon&#39;</span><span class="p">,</span>
    <span class="c1"># ...</span>
<span class="p">]</span>

<span class="c1"># in learning_journal/__init__.py</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">global_config</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s1">&#39;pyramid_chameleon&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="build docutils container">
<p>The <cite>pyramid_chameleon</cite> package supports using the <cite>chameleon</cite> template
language.</p>
<p>The language is quite nice and powerful, but not so easy to learn.</p>
<p>Let's use a different one, <em>jinja2</em></p>
</div>



<div class="slide-no">30</div>


    </article>
  </slide>  <slide class="level-3" id="id23">
    <hgroup>
      <h3>Changing Template Renderers</h3>
    </hgroup>
    <article class="">
      <p>Change <code class="docutils literal"><span class="pre">pyramid_chameleon</span></code> to <code class="docutils literal"><span class="pre">pyramid_jinja2</span></code> in both of these files:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># in setup.py</span>
<span class="n">requires</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;pyramid_jinja2&#39;</span><span class="p">,</span>
    <span class="c1"># ...</span>
<span class="p">]</span>

<span class="c1"># in learning_journal/__init__.py</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">global_config</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s1">&#39;pyramid_jinja2&#39;</span><span class="p">)</span>
</pre></div>
</div>



<div class="slide-no">31</div>


    </article>
  </slide>  <slide class="level-3" id="id24">
    <hgroup>
      <h3>Picking up the Changes</h3>
    </hgroup>
    <article class="">
      <p>We've changed the dependencies for our Pyramid project.</p>
<div class="build docutils container">
<p>As a result, we will need to re-install it so the new dependencies are also
installed:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">(</span>ljenv<span class="o">)</span>$ python setup.py develop
...
Finished processing dependencies <span class="k">for</span> learning-journal<span class="o">==</span>0.0
<span class="o">(</span>ljenv<span class="o">)</span>$
</pre></div>
</div>
<p>Now, we can use <em>Jinja2</em> templates in our project.</p>
<p>Let's learn a bit about how <a class="reference external" href="http://jinja.pocoo.org/docs/templates/">Jinja2 templates</a> work.</p>
</div>



<div class="slide-no">32</div>


    </article>
  </slide>  <slide class="level-3" id="jinja2-template-basics">
    <hgroup>
      <h3>Jinja2 Template Basics</h3>
    </hgroup>
    <article class="">
      <p>We'll start with the absolute basics.</p>
<div class="build docutils container">
<p>Fire up an iPython interpreter, using your <cite>ljenv</cite> virtualenv:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">(</span>ljenv<span class="o">)</span>$ ipython
...
In <span class="o">[</span>1<span class="o">]</span>:
</pre></div>
</div>
<p>Then import the <code class="docutils literal"><span class="pre">Template</span></code> class from the <code class="docutils literal"><span class="pre">jinja2</span></code> package:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">jinja2</span> <span class="kn">import</span> <span class="n">Template</span>
</pre></div>
</div>
</div>



<div class="slide-no">33</div>


    </article>
  </slide>  <slide class="level-3" id="id25">
    <hgroup>
      <h3>Templates are Strings</h3>
    </hgroup>
    <article class="">
      <p>A template is constructed with a simple string:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [2]: </span><span class="n">t1</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;Hello {{ name }}, how are you&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="build docutils container">
<p>Here, we've simply typed the string directly, but it is more common to
build a template from the contents of a <em>file</em>.</p>
<p>Notice that our string has some odd stuff in it: <code class="docutils literal"><span class="pre">{{</span> <span class="pre">name</span> <span class="pre">}}</span></code>.</p>
<p>This is called a <em>placeholder</em> and when the template is <em>rendered</em> it is
replaced.</p>
</div>



<div class="slide-no">34</div>


    </article>
  </slide>  <slide class="level-3" id="id26">
    <hgroup>
      <h3>Rendering a Template</h3>
    </hgroup>
    <article class="">
      <p>Call the <code class="docutils literal"><span class="pre">render</span></code> method, providing <em>context</em>:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [3]: </span><span class="n">t1</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Freddy&quot;</span><span class="p">)</span>
<span class="gh">Out[3]: </span><span class="go">&#39;Hello Freddy, how are you&#39;</span>
<span class="gp">In [4]: </span><span class="n">t1</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Gloria&quot;</span><span class="p">)</span>
<span class="gh">Out[4]: </span><span class="go">&#39;Hello Gloria, how are you&#39;</span>
</pre></div>
</div>
<div class="build docutils container">
<p><em>Context</em> can either be keyword arguments, or a dictionary</p>
<p>Note the resemblance to something you've seen before:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="s2">&quot;This is {owner}&#39;s string&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="s2">&quot;Cris&quot;</span><span class="p">)</span>
<span class="go">&#39;This is Cris&#39;s string&#39;</span>
</pre></div>
</div>
</div>



<div class="slide-no">35</div>


    </article>
  </slide>  <slide class="level-3" id="id27">
    <hgroup>
      <h3>Dictionaries in Context</h3>
    </hgroup>
    <article class="">
      <p>Dictionaries passed in as part of the <em>context</em> can be addressed with <em>either</em>
subscript or dotted notation:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="n">person</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;first_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Frank&#39;</span><span class="p">,</span>
<span class="gp">   ...: </span>          <span class="s1">&#39;last_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Herbert&#39;</span><span class="p">}</span>
<span class="gp">In [6]: </span><span class="n">t2</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;{{ person.last_name }}, {{ person[&#39;first_name&#39;] }}&quot;</span><span class="p">)</span>
<span class="gp">In [7]: </span><span class="n">t2</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">person</span><span class="o">=</span><span class="n">person</span><span class="p">)</span>
<span class="gh">Out[7]: </span><span class="go">&#39;Herbert, Frank&#39;</span>
</pre></div>
</div>
<ul class="build simple">
<li>Jinja2 will try the <em>correct</em> way first (attr for dotted, item for
subscript).</li>
<li>If nothing is found, it will try the opposite.</li>
<li>If nothing is found, it will return an <em>undefined</em> object.</li>
</ul>



<div class="slide-no">36</div>


    </article>
  </slide>  <slide class="level-3" id="id28">
    <hgroup>
      <h3>Objects in Context</h3>
    </hgroup>
    <article class="">
      <p>The exact same is true of objects passed in as part of <em>context</em>:</p>
<div class="build docutils container">
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [8]: </span><span class="n">t3</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;{{ obj.x }} + {{ obj[&#39;y&#39;] }} = Fun!&quot;</span><span class="p">)</span>
<span class="gp">In [9]: </span><span class="k">class</span> <span class="nc">Game</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">   ...: </span>    <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;babies&#39;</span>
<span class="gp">   ...: </span>    <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;bubbles&#39;</span>
<span class="gp">   ...:</span>
<span class="gp">In [10]: </span><span class="n">bathtime</span> <span class="o">=</span> <span class="n">Game</span><span class="p">()</span>
<span class="gp">In [11]: </span><span class="n">t3</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">bathtime</span><span class="p">)</span>
<span class="gh">Out[11]: </span><span class="go">&#39;babies + bubbles = Fun!&#39;</span>
</pre></div>
</div>
<p>This means your templates can be agnostic as to the nature of the
things found in <em>context</em></p>
</div>



<div class="slide-no">37</div>


    </article>
  </slide>  <slide class="level-3" id="id29">
    <hgroup>
      <h3>Filtering values in Templates</h3>
    </hgroup>
    <article class="">
      <p>You can apply <a class="reference external" href="http://jinja.pocoo.org/docs/dev/templates/#filters">filters</a> to the data passed in <em>context</em> with the pipe ('|')
operator:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [12]: </span><span class="n">t4</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;shouted: {{ phrase|upper }}&quot;</span><span class="p">)</span>
<span class="gp">In [13]: </span><span class="n">t4</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">phrase</span><span class="o">=</span><span class="s2">&quot;this is very important&quot;</span><span class="p">)</span>
<span class="gh">Out[13]: </span><span class="go">&#39;shouted: THIS IS VERY IMPORTANT&#39;</span>
</pre></div>
</div>
<div class="build docutils container">
<p>You can also chain filters together:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [14]: </span><span class="n">t5</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;confusing: {{ phrase|upper|reverse }}&quot;</span><span class="p">)</span>
<span class="gp">In [15]: </span><span class="n">t5</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">phrase</span><span class="o">=</span><span class="s2">&quot;howdy doody&quot;</span><span class="p">)</span>
<span class="gh">Out[15]: </span><span class="go">&#39;confusing: YDOOD YDWOH&#39;</span>
</pre></div>
</div>
</div>



<div class="slide-no">38</div>


    </article>
  </slide>  <slide class="level-3" id="id30">
    <hgroup>
      <h3>Control Flow</h3>
    </hgroup>
    <article class="">
      <p>Logical <a class="reference external" href="http://jinja.pocoo.org/docs/dev/templates/#list-of-control-structures">control structures</a> are also available:</p>
<div class="build docutils container">
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [16]: </span><span class="n">tmpl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="gp">   ....: </span><span class="s2">{</span><span class="si">% f</span><span class="s2">or item in list %}{{ item}}, {</span><span class="si">% e</span><span class="s2">ndfor %}</span>
<span class="gp">   ....: </span><span class="s2">&quot;&quot;&quot;</span>
<span class="gp">In [17]: </span><span class="n">t6</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">tmpl</span><span class="p">)</span>
<span class="gp">In [18]: </span><span class="n">t6</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="nb">list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">])</span>
<span class="gh">Out[18]: </span><span class="go">&#39;\na, b, c, d, e, &#39;</span>
</pre></div>
</div>
<p>Any control structure introduced in a template <strong>must</strong> be paired with an
explicit closing tag (<code class="docutils literal"><span class="pre">{%</span> <span class="pre">for</span> <span class="pre">%}...{%</span> <span class="pre">endfor</span> <span class="pre">%}</span></code>)</p>
<p>Remember, although template tags like <code class="docutils literal"><span class="pre">{%</span> <span class="pre">for</span> <span class="pre">%}</span></code> or <code class="docutils literal"><span class="pre">{%</span> <span class="pre">if</span> <span class="pre">%}</span></code> look a
lot like Python, <em>they are not</em>.</p>
<p>The syntax is specific and must be followed correctly.</p>
</div>



<div class="slide-no">39</div>


    </article>
  </slide>  <slide class="level-3" id="id31">
    <hgroup>
      <h3>Template Tests</h3>
    </hgroup>
    <article class="">
      <p>There are a number of specialized <em>tests</em> available for use with the
<code class="docutils literal"><span class="pre">if...elif...else</span></code> control structure:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [19]: </span><span class="n">tmpl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="gp">   ....: </span><span class="s2">{</span><span class="si">% i</span><span class="s2">f phrase is upper %}</span>
<span class="gp">   ....: </span><span class="s2">  {{ phrase|lower }}</span>
<span class="gp">   ....: </span><span class="s2">{</span><span class="si">% e</span><span class="s2">lif phrase is lower %}</span>
<span class="gp">   ....: </span><span class="s2">  {{ phrase|upper }}</span>
<span class="gp">   ....: </span><span class="s2">{</span><span class="si">% e</span><span class="s2">lse %}{{ phrase }}{</span><span class="si">% e</span><span class="s2">ndif %}&quot;&quot;&quot;</span>
<span class="gp">In [20]: </span><span class="n">t7</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">tmpl</span><span class="p">)</span>
<span class="gp">In [21]: </span><span class="n">t7</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">phrase</span><span class="o">=</span><span class="s2">&quot;FOO&quot;</span><span class="p">)</span>
<span class="gh">Out[21]: </span><span class="go">&#39;\n\n  foo\n&#39;</span>
<span class="gp">In [22]: </span><span class="n">t7</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">phrase</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
<span class="gh">Out[22]: </span><span class="go">&#39;\n\n  BAR\n&#39;</span>
<span class="gp">In [23]: </span><span class="n">t7</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">phrase</span><span class="o">=</span><span class="s1">&#39;This should print as-is&#39;</span><span class="p">)</span>
<span class="gh">Out[23]: </span><span class="go">&#39;\nThis should print as-is&#39;</span>
</pre></div>
</div>



<div class="slide-no">40</div>


    </article>
  </slide>  <slide class="level-3" id="id32">
    <hgroup>
      <h3>Basic Expressions</h3>
    </hgroup>
    <article class="">
      <p>Basic <a class="reference external" href="http://jinja.pocoo.org/docs/dev/templates/#expressions">Python-like expressions</a> are also supported:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [24]: </span><span class="n">tmpl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="gp">   ....: </span><span class="s2">{</span><span class="si">% s</span><span class="s2">et sum = 0 %}</span>
<span class="gp">   ....: </span><span class="s2">{</span><span class="si">% f</span><span class="s2">or val in values %}</span>
<span class="gp">   ....: </span><span class="s2">{{ val }}: {{ sum + val }}</span>
<span class="gp">   ....: </span><span class="s2">  {</span><span class="si">% s</span><span class="s2">et sum = sum + val %}</span>
<span class="gp">   ....: </span><span class="s2">{</span><span class="si">% e</span><span class="s2">ndfor %}</span>
<span class="gp">   ....: </span><span class="s2">&quot;&quot;&quot;</span>
<span class="gp">In [25]: </span><span class="n">t8</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">tmpl</span><span class="p">)</span>
<span class="gp">In [26]: </span><span class="n">t8</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
<span class="gh">Out[26]: </span><span class="go">&#39;\n\n\n1: 1\n  \n\n2: 3\n  \n\n3: 6\n  \n\n4: 10\n</span>
<span class="go">          \n\n5: 15\n  \n\n6: 21\n  \n\n7: 28\n  \n\n8: 36\n</span>
<span class="go">          \n\n9: 45\n  \n\n10: 55\n  \n\n&#39;</span>
</pre></div>
</div>



<div class="slide-no">41</div>


    </article>
  </slide>  <slide class="level-3" id="our-templates">
    <hgroup>
      <h3>Our Templates</h3>
    </hgroup>
    <article class="">
      <p>There's more that Jinja2 templates can do, but it will be easier to introduce
you to that in the context of a working template.  So let's make some.</p>



<div class="slide-no">42</div>


    </article>
  </slide>  <slide class="level-3" id="id33">
    <hgroup>
      <h3>Detail Template</h3>
    </hgroup>
    <article class="">
      <p>We have a Pyramid view that returns a single entry. Let's create a template to
show it.</p>
<div class="build docutils container">
<p>In <code class="docutils literal"><span class="pre">learning_journal/templates</span></code> create a new file <code class="docutils literal"><span class="pre">detail.jinja2</span></code>:</p>
<div class="highlight-jinja"><div class="highlight"><pre><span></span><span class="x">&lt;article&gt;</span>
<span class="x">  &lt;h1&gt;</span><span class="cp">{{</span> <span class="nv">entry.title</span> <span class="cp">}}</span><span class="x">&lt;/h1&gt;</span>
<span class="x">  &lt;hr/&gt;</span>
<span class="x">  &lt;p&gt;</span><span class="cp">{{</span> <span class="nv">entry.body</span> <span class="cp">}}</span><span class="x">&lt;/p&gt;</span>
<span class="x">  &lt;hr/&gt;</span>
<span class="x">  &lt;p&gt;Created &lt;strong title=&quot;</span><span class="cp">{{</span> <span class="nv">entry.created</span> <span class="cp">}}</span><span class="x">&quot;&gt;</span><span class="cp">{{</span><span class="nv">entry.created</span><span class="cp">}}</span><span class="x">&lt;/strong&gt;&lt;/p&gt;</span>
<span class="x">&lt;/article&gt;</span>
</pre></div>
</div>
<p>Then wire it up to the detail view in <code class="docutils literal"><span class="pre">views.py</span></code>:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="c1"># views.py</span>
<span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;detail&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;templates/detail.jinja2&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
</div>



<div class="slide-no">43</div>


    </article>
  </slide>  <slide class="level-3" id="id34">
    <hgroup>
      <h3>Try It Out</h3>
    </hgroup>
    <article class="">
      <p>Now we should be able to see some rendered HTML for our journal entry details.</p>
<div class="build docutils container">
<p>Start up your server:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">(</span>ljenv<span class="o">)</span>$ pserve development.ini
Starting server in PID 90536.
serving on http://0.0.0.0:6543
</pre></div>
</div>
<p>Then try viewing an individual journal entry</p>
<ul class="simple">
<li><a class="reference external" href="http://localhost:6543/journal/1">http://localhost:6543/journal/1</a></li>
</ul>
</div>



<div class="slide-no">44</div>


    </article>
  </slide>  <slide class="level-3" id="id35">
    <hgroup>
      <h3>Listing Page</h3>
    </hgroup>
    <article class="">
      <p>The index page of our journal should show a list of journal entries, let's do
that next.</p>
<div class="build docutils container">
<p>In <code class="docutils literal"><span class="pre">learning_journal/templates</span></code> create a new file <code class="docutils literal"><span class="pre">list.jinja2</span></code>:</p>
<div class="highlight-jinja"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">entries</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;h2&gt;Journal Entries&lt;/h2&gt;</span>
<span class="x">&lt;ul&gt;</span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">entry</span> <span class="k">in</span> <span class="nv">entries</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    &lt;li&gt;</span>
<span class="x">    &lt;a href=&quot;</span><span class="cp">{{</span> <span class="nv">request.route_url</span><span class="o">(</span><span class="s1">&#39;detail&#39;</span><span class="o">,</span> <span class="nv">id</span><span class="o">=</span><span class="nv">entry.id</span><span class="o">)</span> <span class="cp">}}</span><span class="x">&quot;&gt;</span><span class="cp">{{</span> <span class="nv">entry.title</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;</span>
<span class="x">    &lt;/li&gt;</span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;/ul&gt;</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;p&gt;This journal is empty&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
</div>



<div class="slide-no">45</div>


    </article>
  </slide>  <slide class="level-3" id="id36">
    <hgroup>
      <h3>Our Templates</h3>
    </hgroup>
    <article class="">
      <p>It's worth taking a look at a few specifics of this template.</p>
<div class="build docutils container">
<div class="highlight-jinja"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">entry</span> <span class="k">in</span> <span class="nv">entries</span> <span class="cp">%}</span><span class="x"></span>
<span class="x"> ...</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
<p>Jinja2 templates are rendered with a <em>context</em>.</p>
<p>A Pyramid <em>view</em> returns a dictionary, which is passed to the renderer as
part of of that <em>context</em></p>
<p>This means we can access values we return from our <em>view</em> in the <em>renderer</em>
using the names we assigned to them.</p>
</div>



<div class="slide-no">46</div>


    </article>
  </slide>  <slide class="level-3" id="id37">
    <hgroup>
      <h3>Our Templates</h3>
    </hgroup>
    <article class="">
      <p>It's worth taking a look at a few specifics of this template.</p>
<blockquote>
<div><div class="highlight-jinja"><div class="highlight"><pre><span></span><span class="x">&lt;a href=&quot;</span><span class="cp">{{</span> <span class="nv">request.route_url</span><span class="o">(</span><span class="s1">&#39;detail&#39;</span><span class="o">,</span> <span class="nv">id</span><span class="o">=</span><span class="nv">entry.id</span><span class="o">)</span> <span class="cp">}}</span><span class="x">&quot;&gt;</span><span class="cp">{{</span> <span class="nv">entry.title</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;</span>
</pre></div>
</div>
<p>The <em>request</em> object is also placed in the context by Pyramid.</p>
<p>Request has a method <code class="docutils literal"><span class="pre">route_url</span></code> that will create a URL for a named
route.</p>
<p>This allows you to include URLs in your template without needing to know
exactly what they will be.</p>
<p>This process is called <em>reversing</em>, since it's a bit like a reverse phone
book lookup.</p>
</div></blockquote>



<div class="slide-no">47</div>


    </article>
  </slide>  <slide class="level-3" id="id38">
    <hgroup>
      <h3>Our Templates</h3>
    </hgroup>
    <article class="">
      <p>Finally, you'll need to connect this new renderer to your listing view:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;templates/list.jinja2&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># ...</span>
</pre></div>
</div>



<div class="slide-no">48</div>


    </article>
  </slide>  <slide class="level-3" id="id39">
    <hgroup>
      <h3>Try It Out</h3>
    </hgroup>
    <article class="">
      <p>We can now see our list page too.  Let's try starting the server:</p>
<div class="build docutils container">
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">(</span>ljenv<span class="o">)</span>$ pserve development.ini
Starting server in PID 90536.
serving on http://0.0.0.0:6543
</pre></div>
</div>
<p>Then try viewing the home page of your journal:</p>
<ul class="simple">
<li><a class="reference external" href="http://localhost:6543/">http://localhost:6543/</a></li>
</ul>
<p>Click on the link to an entry, it should work.</p>
</div>



<div class="slide-no">49</div>


    </article>
  </slide>  <slide class="level-3" id="id40">
    <hgroup>
      <h3>Sharing Structure</h3>
    </hgroup>
    <article class="">
      <p>These views are reasonable, if quite plain.</p>
<div class="build docutils container">
<p>It'd be nice to put them into something that looks a bit more like a
website.</p>
<p>Jinja2 allows you to combine templates using something called
<a class="reference external" href="http://jinja.pocoo.org/docs/dev/templates/#template-inheritance">template inheritance</a>.</p>
<p>You can create a basic page structure, and then <em>inherit</em> that structure in
other templates.</p>
<p>In our class resources I've added a page template <code class="docutils literal"><span class="pre">layout.jinja2</span></code>.  Copy
that page to your templates directory</p>
</div>



<div class="slide-no">50</div>


    </article>
  </slide>  <slide class="level-3" id="id41">
    <hgroup>
      <h3><code class="docutils literal"><span class="pre">layout.jinja2</span></code></h3>
    </hgroup>
    <article class="">
      <div class="highlight-jinja"><div class="highlight"><pre><span></span><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="x">&lt;html lang=&quot;en&quot;&gt;</span>
<span class="x">  &lt;head&gt;</span>
<span class="x">    &lt;meta charset=&quot;utf-8&quot;&gt;</span>
<span class="x">    &lt;title&gt;Python Learning Journal&lt;/title&gt;</span>
<span class="x">    &lt;!--[if lt IE 9]&gt;&lt;script src=&quot;http://html5shiv.googlecode.com/svn/trunk/html5.js&quot;&gt;&lt;/script&gt;&lt;![endif]--&gt;</span>
<span class="x">  &lt;/head&gt;</span>
<span class="x">  &lt;body&gt;</span>
<span class="x">    &lt;header&gt;</span>
<span class="x">      &lt;nav&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;</span><span class="cp">{{</span> <span class="nv">request.route_url</span><span class="o">(</span><span class="s1">&#39;home&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x">&quot;&gt;Home&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/nav&gt;</span>
<span class="x">    &lt;/header&gt;</span>
<span class="x">    &lt;main&gt;</span>
<span class="x">      &lt;h1&gt;My Python Journal&lt;/h1&gt;</span>
<span class="x">      &lt;section id=&quot;content&quot;&gt;</span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">&lt;/section&gt;</span>
<span class="x">    &lt;/main&gt;</span>
<span class="x">    &lt;footer&gt;&lt;p&gt;Created in the UW PCE Python Certificate Program&lt;/p&gt;&lt;/footer&gt;</span>
<span class="x">  &lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</pre></div>
</div>



<div class="slide-no">51</div>


    </article>
  </slide>  <slide class="level-3" id="id42">
    <hgroup>
      <h3>Template Blocks</h3>
    </hgroup>
    <article class="">
      <p>The important part here is the <code class="docutils literal"><span class="pre">{%</span> <span class="pre">block</span> <span class="pre">body</span> <span class="pre">%}{%</span> <span class="pre">endblock</span> <span class="pre">%}</span></code> expression.</p>
<div class="build docutils container">
<p>This is a template <strong>block</strong> and it is a kind of placeholder.</p>
<p>Other templates can inherit from this one, and fill that block with
additional HTML.</p>
<p>Let's update our detail and list templates:</p>
<div class="highlight-jinja"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;layout.jinja2&quot;</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;!-- everything else that was already there goes here --&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
</div>



<div class="slide-no">52</div>


    </article>
  </slide>  <slide class="level-3" id="id43">
    <hgroup>
      <h3>Try It Out</h3>
    </hgroup>
    <article class="">
      <p>Let's try starting the server so we can see the result:</p>
<div class="build docutils container">
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">(</span>ljenv<span class="o">)</span>$ pserve development.ini
Starting server in PID 90536.
serving on http://0.0.0.0:6543
</pre></div>
</div>
<p>Then try viewing the home page of your journal:</p>
<ul class="simple">
<li><a class="reference external" href="http://localhost:6543/">http://localhost:6543/</a></li>
</ul>
<p>Click on the link to an entry, it should work.</p>
<p>And now you have shared page structure that is in both.</p>
</div>



<div class="slide-no">53</div>


    </article>
  </slide>  <slide class="level-3" id="static-assets">
    <hgroup>
      <h3>Static Assets</h3>
    </hgroup>
    <article class="">
      <p>Although we have a shared structure, it isn't particularly nice to look at.</p>
<div class="build docutils container">
<p>Aspects of how a website looks are controlled by CSS (<em>Cascading Style
Sheets</em>).</p>
<p>Stylesheets are one of what we generally speak of as <em>static assets</em>.</p>
<p>Other static assets include <em>images</em> that are part of the look and feel of
the site (logos, button images, etc) and the <em>JavaScript</em> files that add
client-side dynamic behavior to the site.</p>
</div>



<div class="slide-no">54</div>


    </article>
  </slide>  <slide class="level-3" id="id44">
    <hgroup>
      <h3>Static Assets in Pyramid</h3>
    </hgroup>
    <article class="">
      <p>Serving static assets in Pyramid requires a <em>static view</em> to configuration.
Luckily, <code class="docutils literal"><span class="pre">pcreate</span></code> already handled that for us:</p>
<div class="build docutils container">
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># in learning_journal/__init__.py</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">global_config</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_static_view</span><span class="p">(</span><span class="s1">&#39;static&#39;</span><span class="p">,</span> <span class="s1">&#39;static&#39;</span><span class="p">,</span> <span class="n">cache_max_age</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>The first argument to <code class="docutils literal"><span class="pre">add_static_view</span></code> is a <em>name</em> that will need to
appear in the path of URLs requesting assets.</p>
<p>The second argument is a <em>path</em> that is relative to the package being
configured.</p>
<p>Assets referenced by the <em>name</em> in a URL will be searched for in the
location defined by the <em>path</em></p>
<p>Additional keyword arguments control other aspects of how the view works.</p>
</div>



<div class="slide-no">55</div>


    </article>
  </slide>  <slide class="level-3" id="id45">
    <hgroup>
      <h3>Static Assets in Templates</h3>
    </hgroup>
    <article class="">
      <p>Once you have a static view configured, you can use assets in that location in
templates.</p>
<div class="build docutils container">
<p>The <em>request</em> object in Pyramid provides a <code class="docutils literal"><span class="pre">static_path</span></code> method that
will render an appropriate asset path for us.</p>
<p>Add the following to our <code class="docutils literal"><span class="pre">layout.jinja2</span></code> template:</p>
<div class="highlight-jinja"><div class="highlight"><pre><span></span><span class="x">&lt;head&gt;</span>
<span class="x">  &lt;!-- ... --&gt;</span>
<span class="x">  &lt;link href=&quot;</span><span class="cp">{{</span> <span class="nv">request.static_path</span><span class="o">(</span><span class="s1">&#39;learning_journal:static/styles.css&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x">&quot; rel=&quot;stylesheet&quot;&gt;</span>
<span class="x">&lt;/head&gt;</span>
</pre></div>
</div>
<p>The one required argument to <code class="docutils literal"><span class="pre">request.static_path</span></code> is a <em>path</em> to an
asset.</p>
<p>Note that because any package <em>might</em> define a static view, we have to
specify which package we want to look in.</p>
<p>That's why we have <code class="docutils literal"><span class="pre">learning_journal:static/styles.css</span></code> in our call.</p>
</div>



<div class="slide-no">56</div>


    </article>
  </slide>  <slide class="level-3" id="id46">
    <hgroup>
      <h3>Basic Styles</h3>
    </hgroup>
    <article class="">
      <p>I've created some very very basic styles for our learning journal.</p>
<div class="build docutils container">
<p>You can find them in <code class="docutils literal"><span class="pre">resources/session06/styles.css</span></code>.  Go ahead and copy
that file.</p>
<p>Add it to <code class="docutils literal"><span class="pre">learning_journal/static</span></code>.</p>
<p>Then restart your web server and see what a difference a little style
makes:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">(</span>ljenv<span class="o">)</span>$ pserve development.ini
Starting server in PID 90536.
serving on http://0.0.0.0:6543
</pre></div>
</div>
</div>



<div class="slide-no">57</div>


    </article>
  </slide>  <slide class="level-3" id="id47">
    <hgroup>
      <h3>The Outcome</h3>
    </hgroup>
    <article class="">
      <p>Your site should look something like this:</p>
<div class="figure align-center" id="id3">
<a class="reference internal image-reference" href="../_images/learning_journal_styled.png"><img alt="../_images/learning_journal_styled.png" src="../_images/learning_journal_styled.png" style="width: 75%;" /></a>
<p class="caption"><span class="caption-text">The learning journal with basic styles applied</span></p>
</div>



<div class="slide-no">58</div>


    </article>
  </slide>  <slide class="level-2" id="getting-interactive">
    <hgroup>
      <h2>Getting Interactive</h2>
    </hgroup>
    <article class="">
      <div class="left docutils container">
<p>We have a site that allows us to view a list of journal entries.</p>
<div class="build docutils container">
<p>We can also view the details of a single entry.</p>
<p>But as yet, we don't really have any <em>interaction</em> in our site yet.</p>
<p>We can't create new entries.</p>
<p>Let's add that functionality next.</p>
</div>
</div>



<div class="slide-no">59</div>


    </article>
  </slide>  <slide class="level-3" id="user-input">
    <hgroup>
      <h3>User Input</h3>
    </hgroup>
    <article class="">
      <p>In HTML websites, the traditional way of getting input from users is via
<a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Forms">HTML forms</a>.</p>
<div class="build docutils container">
<p>Forms use <em>input elements</em> to allow users to enter data, pick from
drop-down lists, or choose items via checkbox or radio button.</p>
<p>It is possible to create plain HTML forms in templates and use them with
Pyramid.</p>
<p>It's a lot easier, however, to work with a <em>form library</em> to create forms,
render them in templates and interact with data sent by a client.</p>
<p>We'll be using a form library called <a class="reference external" href="http://wtforms.readthedocs.org/en/latest/">WTForms</a> in our project</p>
</div>



<div class="slide-no">60</div>


    </article>
  </slide>  <slide class="level-3" id="id48">
    <hgroup>
      <h3>Installing WTForms</h3>
    </hgroup>
    <article class="">
      <p>The first step to working with this library is to install it.</p>
<div class="build docutils container">
<p>Start by makin the library as a <em>dependency</em> of our package by adding it to
the <em>requires</em> list in <code class="docutils literal"><span class="pre">setup.py</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;wtforms&#39;</span><span class="p">,</span> <span class="c1"># &lt;- add this to the list</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Then, re-install our package to download and install the new dependency:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">(</span>ljenv<span class="o">)</span>$ python setup.py develop
...
Finished processing dependencies <span class="k">for</span> learning-journal<span class="o">==</span>0.0
</pre></div>
</div>
</div>



<div class="slide-no">61</div>


    </article>
  </slide>  <slide class="level-3" id="using-wtforms">
    <hgroup>
      <h3>Using WTForms</h3>
    </hgroup>
    <article class="">
      <p>We'll want a form to allow a user to create a new Journal Entry.</p>
<div class="build docutils container">
<p>Add a new file called <code class="docutils literal"><span class="pre">forms.py</span></code> in our learning_journal package, next to
<code class="docutils literal"><span class="pre">models.py</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wtforms</span> <span class="kn">import</span> <span class="n">Form</span><span class="p">,</span> <span class="n">TextField</span><span class="p">,</span> <span class="n">TextAreaField</span><span class="p">,</span> <span class="n">validators</span>

<span class="n">strip_filter</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span> <span class="k">else</span> <span class="bp">None</span>

<span class="k">class</span> <span class="nc">EntryCreateForm</span><span class="p">(</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">(</span>
        <span class="s1">&#39;Entry title&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="n">validators</span><span class="o">.</span><span class="n">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">255</span><span class="p">)],</span>
        <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="n">strip_filter</span><span class="p">])</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">TextAreaField</span><span class="p">(</span>
        <span class="s1">&#39;Entry body&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="n">validators</span><span class="o">.</span><span class="n">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">)],</span>
        <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="n">strip_filter</span><span class="p">])</span>
</pre></div>
</div>
</div>



<div class="slide-no">62</div>


    </article>
  </slide>  <slide class="level-3" id="id49">
    <hgroup>
      <h3>Using a Form in a View</h3>
    </hgroup>
    <article class="">
      <p>Next, we need to add a new view that uses this form to create a new entry.</p>
<div class="build docutils container">
<p>Add this to <code class="docutils literal"><span class="pre">views.py</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># add these imports</span>
<span class="kn">from</span> <span class="nn">pyramid.httpexceptions</span> <span class="kn">import</span> <span class="n">HTTPFound</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">EntryCreateForm</span>

<span class="c1"># and update this view function</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">entry</span> <span class="o">=</span> <span class="n">Entry</span><span class="p">()</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">EntryCreateForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span> <span class="ow">and</span> <span class="n">form</span><span class="o">.</span><span class="n">validate</span><span class="p">():</span>
        <span class="n">form</span><span class="o">.</span><span class="n">populate_obj</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="n">DBSession</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">matchdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">)}</span>
</pre></div>
</div>
</div>



<div class="slide-no">63</div>


    </article>
  </slide>  <slide class="level-3" id="id50">
    <hgroup>
      <h3>Testing the Route/View Connection</h3>
    </hgroup>
    <article class="">
      <p>We already have a route that connects here.  Let's test it.</p>
<div class="build docutils container">
<p>Start your server:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">(</span>ljenv<span class="o">)</span>$ pserve development.ini
Starting server in PID 90536.
serving on http://0.0.0.0:6543
</pre></div>
</div>
<p>And then try connecting to the <code class="docutils literal"><span class="pre">action</span></code> route:</p>
<ul class="simple">
<li><a class="reference external" href="http://localhost:6543/journal/create">http://localhost:6543/journal/create</a></li>
</ul>
<p>You should see something like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">u&#39;create&#39;</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">learning_journal</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">EntryCreateForm</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x10e7d6b90</span><span class="o">&gt;</span><span class="p">}</span>
</pre></div>
</div>
</div>



<div class="slide-no">64</div>


    </article>
  </slide>  <slide class="level-3" id="id51">
    <hgroup>
      <h3>Rendering A Form</h3>
    </hgroup>
    <article class="">
      <p>Finally, we need to create a template that will render our form.</p>
<div class="build docutils container">
<p>Add a new template called <code class="docutils literal"><span class="pre">edit.jinja2</span></code> in
<code class="docutils literal"><span class="pre">learning_journal/templates</span></code>:</p>
<div class="highlight-jinja"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;templates/layout.jinja2&quot;</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;form action=&quot;.&quot; method=&quot;POST&quot;&gt;</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">field</span> <span class="k">in</span> <span class="nv">form</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">field.errors</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    &lt;ul&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">error</span> <span class="k">in</span> <span class="nv">field.errors</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">        &lt;li&gt;</span><span class="cp">{{</span> <span class="nv">error</span> <span class="cp">}}</span><span class="x">&lt;/li&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    &lt;/ul&gt;</span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    &lt;p&gt;</span><span class="cp">{{</span> <span class="nv">field.label</span> <span class="cp">}}</span><span class="x">: </span><span class="cp">{{</span> <span class="nv">field</span> <span class="cp">}}</span><span class="x">&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    &lt;p&gt;&lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Submit&quot; /&gt;&lt;/p&gt;</span>
<span class="x">&lt;/form&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
</div>



<div class="slide-no">65</div>


    </article>
  </slide>  <slide class="level-3" id="id52">
    <hgroup>
      <h3>Connecting the Renderer</h3>
    </hgroup>
    <article class="">
      <p>You'll need to update the view configuration to use this new renderer.</p>
<div class="build docutils container">
<p>Update the configuration in <code class="docutils literal"><span class="pre">learning_journal/views.py</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="n">match_param</span><span class="o">=</span><span class="s1">&#39;action=create&#39;</span><span class="p">,</span>
             <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;templates/edit.jinja2&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>And then you should be able to start your server and test:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">(</span>ljenv<span class="o">)</span>$ pserve development.ini
Starting server in PID 90536.
serving on http://0.0.0.0:6543
</pre></div>
</div>
<ul class="simple">
<li><a class="reference external" href="http://localhost:6543/journal/create">http://localhost:6543/journal/create</a></li>
</ul>
</div>



<div class="slide-no">66</div>


    </article>
  </slide>  <slide class="level-3" id="id53">
    <hgroup>
      <h3>Providing Access</h3>
    </hgroup>
    <article class="">
      <p>Great!  Now you can add new entries to your journal.</p>
<div class="build docutils container">
<p>But in order to do so, you have to hand-enter the url.</p>
<p>You should add a new link in the UI somewhere that helps you get there more
easily.</p>
<p>Add the following to <code class="docutils literal"><span class="pre">list.jinja2</span></code>:</p>
<div class="highlight-jinja"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;layout.jinja2&quot;</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">entries</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">...</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">...</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;!-- Add This Link --&gt;</span>
<span class="x">&lt;p&gt;&lt;a href=&quot;</span><span class="cp">{{</span> <span class="nv">request.route_url</span><span class="o">(</span><span class="s1">&#39;action&#39;</span><span class="o">,</span> <span class="nv">action</span><span class="o">=</span><span class="s1">&#39;create&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x">&quot;&gt;New Entry&lt;/a&gt;&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
</div>



<div class="slide-no">67</div>


    </article>
  </slide>  <slide class="level-2" id="homework">
    <hgroup>
      <h2>Homework</h2>
    </hgroup>
    <article class="">
      <div class="left docutils container">
<p>You have a website now that allows you to create, view and list journal
entries</p>
<div class="build docutils container">
<p>However, there are still a few flaws in this system.</p>
<p>You should be able to edit a journal entry that already exists, in case
you make a spelling error.</p>
<p>It would also be nice to see a prettier site.</p>
<p>Let's handle that for homework this week.</p>
</div>
</div>



<div class="slide-no">68</div>


    </article>
  </slide>  <slide class="level-3" id="part-1-add-editing">
    <hgroup>
      <h3>Part 1: Add Editing</h3>
    </hgroup>
    <article class="">
      <p>For part one of your assignment, add editing of existing entries. You will need:</p>
<ul class="simple">
<li>A form that shows an existing entry (what is different about this form from
one for creating a new entry?)</li>
<li>A pyramid view that handles that form. It should:<ul>
<li>Show the form with the requested entry when the page is first loaded</li>
<li>Accept edits only on POST</li>
<li>Update an existing entry with new data from the form</li>
<li>Show the view of the entry after editing so that the user can see the edits
saved correctly</li>
<li>Show errors from form validation, if any are present</li>
</ul>
</li>
<li>A link somewhere that leads to the editing page for a single entry (probably
on the view page for a entry)</li>
</ul>
<p>You'll need to update a bit of configuration, but not much.  Use the create
form we did here in class as an example.</p>



<div class="slide-no">69</div>


    </article>
  </slide>  <slide class="level-3" id="part-2-make-it-yours">
    <hgroup>
      <h3>Part 2: Make it Yours</h3>
    </hgroup>
    <article class="">
      <p>I've created for you a very bare-bones layout and stylesheet.</p>
<p>You will certainly want to add a bit of your own style and panache.</p>
<p>Spend a few hours this week playing with the styles and getting a site that
looks more like you want it to look.</p>
<p>The Mozilla Developer Network has <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/CSS">some excellent resources</a> for learning CSS.</p>
<p>In particular, the <a class="reference external" href="https://developer.mozilla.org/en-US/docs/CSS/Getting_Started">Getting Started with CSS</a> tutorial is a thorough
introduction to the basics.</p>
<p>You might also look at their <a class="reference external" href="https://developer.mozilla.org/en-US/demos/tag/tech:css3">CSS 3 Demos</a> to help fire up your creative
juices.</p>
<p>Here are a few more resources:</p>
<ul class="simple">
<li><a class="reference external" href="http://alistapart.com">A List Apart</a> offers outstanding articles.  Their
<a class="reference external" href="http://alistapart.com/topics">Topics list</a> is worth a browse.</li>
<li><a class="reference external" href="http://www.smashingmagazine.com">Smashing Magazine</a> is another excellent
resource for articles on design.</li>
</ul>



<div class="slide-no">70</div>


    </article>
  </slide>  <slide class="level-3" id="part-3-user-model">
    <hgroup>
      <h3>Part 3: User Model</h3>
    </hgroup>
    <article class="">
      <p>As it stands, our journal accepts entries from anyone who comes by.</p>
<p>Next week we will add security to allow only logged-in users to create and edit
entries.</p>
<p>To do so, we'll need a user model</p>
<p>The model should have:</p>
<ul class="simple">
<li>An <code class="docutils literal"><span class="pre">id</span></code> field that is a primary key</li>
<li>A <code class="docutils literal"><span class="pre">username</span></code> field that is unicode, no more than 255 characters, not
nullable, unique and indexed.</li>
<li>A <code class="docutils literal"><span class="pre">password</span></code> field that is unicode and not nullable</li>
</ul>
<p>In addition, the model should have a classmethod that retrieves a specific user
when given a username.</p>



<div class="slide-no">71</div>


    </article>
  </slide>  <slide class="level-3" id="part-4-preparation-for-deployment">
    <hgroup>
      <h3>Part 4: Preparation for Deployment</h3>
    </hgroup>
    <article class="">
      <p>At the end of class next week we will be deploying our application to Heroku.</p>
<p>You will need to get a free account.</p>
<p>Once you have your free account set up and you have logged in, run through the
<a class="reference external" href="https://devcenter.heroku.com/articles/getting-started-with-python#introduction">getting started with Python</a> tutorial.</p>
<p>Be sure to at least complete the <em>set up</em> step. It will have you install the
Heroku Toolbelt, which you will need to have ready in class.</p>



<div class="slide-no">72</div>


    </article>
  </slide>  <slide class="level-3" id="submitting-your-work">
    <hgroup>
      <h3>Submitting Your Work</h3>
    </hgroup>
    <article class="">
      <p>As usual, submit your work by committing and pushing it to your project github
repository</p>
<p>Commit early and commit often.</p>
<p>Write yourself good commit messages explaining what you have done and why.</p>
<p>When you are ready to have your work reviewed, email the link to your
repository to us, we'll take a look and make comments.</p>



<div class="slide-no">73</div>


    </article>
  </slide>


    <slide class="thank-you-slide segue nobackground">
    <aside class="gdbar right"><img src="../_static/logo_UW.png"></aside>
    <article class="flexbox vleft auto-fadein">
      <h2>Good Night!</h2>
      <p>&nbsp;</p>
    </article>
    <p class="auto-fadein" data-config-contact>
      <!-- populated from slide_config.json -->
    </p>
  </slide>

  <slide class="backdrop"></slide>

</slides>

<!--[if IE]>
  <script src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"></script>
  <script>CFInstall.check({mode: 'overlay'});</script>
<![endif]-->
</body>
</html>